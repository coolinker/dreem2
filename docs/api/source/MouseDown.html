<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='global-property-'>/** Provides a &#39;mousedown&#39; attribute that tracks mouse up/down state.
</span>    
    Requires: dr.MouseOver super mixins.
    
    Suggested: dr.UpdateableUI and dr.Activateable super mixins.
    
    Attributes:
        mousedown:boolean Indicates if the mouse is down or not.
*/
define(function(require, exports, module) {
    var dr = require(&#39;$LIB/dr/dr.js&#39;),
        JS = require(&#39;$LIB/jsclass.js&#39;);
    require(&#39;./MouseOver.js&#39;);
    require(&#39;$LIB/dr/globals/GlobalMouse.js&#39;);
    
    module.exports = dr.MouseDown = new JS.Module(&#39;MouseDown&#39;, {
        // Life Cycle //////////////////////////////////////////////////////////////
<span id='global-method-initNode'>        /** @overrides */
</span>        initNode: function(parent, attrs) {
            if (attrs.mousedown === undefined) attrs.mousedown = false;
            if (attrs.clickable === undefined) attrs.clickable = true;
            
            this.callSuper(parent, attrs);
            
            this.listenToPlatform(this, &#39;onmousedown&#39;, &#39;doMouseDown&#39;);
            this.listenToPlatform(this, &#39;onmouseup&#39;, &#39;doMouseUp&#39;);
        },
        
        
        // Accessors ///////////////////////////////////////////////////////////////
        set_mousedown: function(v) {
            if (this.setActual(&#39;mousedown&#39;, v, &#39;boolean&#39;, false)) {
                if (this.initing === false) {
                    if (this.mousedown) this.focus(true);
                    if (this.updateUI) this.updateUI();
                }
            }
        },
        
<span id='global-method-set_disabled'>        /** @overrides dr.Disableable */
</span>        set_disabled: function(v) {
            if (this.callSuper) this.callSuper(v);
            
            // When about to disable the view make sure mousedown is not true. This 
            // helps prevent unwanted activation of a disabled view.
            if (this.disabled &amp;&amp; this.mousedown) this.set_mousedown(false);
        },
        
        
        // Methods /////////////////////////////////////////////////////////////////
<span id='global-method-doMouseOver'>        /** @overrides dr.MouseOver */
</span>        doMouseOver: function(event) {
            this.callSuper(event);
            if (this.mousedown) this.stopListeningToPlatform(dr.global.mouse, &#39;onmouseup&#39;, &#39;doMouseUp&#39;, true);
        },
        
<span id='global-method-doMouseOut'>        /** @overrides dr.MouseOut */
</span>        doMouseOut: function(event) {
            this.callSuper(event);
            
            // Wait for a mouse up anywhere if the user moves the mouse out of the
            // view while the mouse is still down. This allows the user to move
            // the mouse in and out of the view with the view still behaving 
            // as moused down.
            if (!this.disabled &amp;&amp; this.mousedown) this.listenToPlatform(dr.global.mouse, &#39;onmouseup&#39;, &#39;doMouseUp&#39;, true);
        },
        
<span id='global-method-doMouseDown'>        /** Called when the mouse is down on this view. Subclasses must call callSuper.
</span>            @returns void */
        doMouseDown: function(event) {
            if (!this.disabled) this.set_mousedown(true);
        },
        
<span id='global-method-doMouseUp'>        /** Called when the mouse is up on this view. Subclasses must call callSuper.
</span>            @returns void */
        doMouseUp: function(event) {
            // Cleanup global mouse listener since the mouseUp occurred outside
            // the view.
            if (!this.mouseover) this.stopListeningToPlatform(dr.global.mouse, &#39;onmouseup&#39;, &#39;doMouseUp&#39;, true);
            
            if (!this.disabled &amp;&amp; this.mousedown) {
                this.set_mousedown(false);
                
                // Only do mouseUpInside if the mouse is actually over the view.
                // This means the user can mouse down on a view, move the mouse
                // out and then mouse up and not &quot;activate&quot; the view.
                if (this.mouseover) {
                    this.doMouseUpInside(event);
                } else {
                    this.doMouseUpOutside(event);
                }
            }
        },
        
<span id='global-method-doMouseUpInside'>        /** Called when the mouse is up and we are still over the view. Executes
</span>            the &#39;doActivated&#39; method by default.
            @returns void */
        doMouseUpInside: function(event) {
            if (this.doActivated) this.doActivated();
        },
        
<span id='global-method-doMouseUpOutside'>        /** Called when the mouse is up and we are not over the view. Fires
</span>            an &#39;onmouseupoutside&#39; event.
            @returns void */
        doMouseUpOutside: function(event) {
            if (!this.disabled) {
                this.sendEvent(&#39;onmouseupoutside&#39;, true);
                
                // Also try and send it to the global mouse
                dr.mouse.sendEvent(&#39;onmouseupoutside&#39;, true);
            }
        }
    });
});
</pre>
</body>
</html>
